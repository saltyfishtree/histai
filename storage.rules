rules_version = '2';

// Craft rules based on data in your Firestore database
// allow write: if firestore.get(
//    /databases/(default)/documents/users/$(request.auth.uid)).data.isAuthor == true;
service firebase.storage {
  match /b/{bucket}/o {
    // Images: 用户可以读取，但只有认证用户可以上传
    match /images/{imageId} {
      allow read: if true;
      allow write: if request.auth != null
                   && request.resource.size < 5 * 1024 * 1024  // 限制文件大小 5MB
                   && request.resource.contentType.matches('image/.*');
    }
    
    // 文档: 用户可以读取，但只有认证用户可以上传
    match /documents/{docId} {
      allow read: if true;
      allow write: if request.auth != null
                   && request.resource.size < 10 * 1024 * 1024  // 限制文件大小 10MB
                   && (request.resource.contentType.matches('application/pdf')
                   || request.resource.contentType.matches('text/.*')
                   || request.resource.contentType.matches('application/msword')
                   || request.resource.contentType.matches('application/vnd.openxmlformats-officedocument.wordprocessingml.document'));
    }
    
    // 用户上传的问题相关文件
    match /submissions/{submissionId}/{fileName} {
      allow read: if true;
      allow write: if request.auth != null
                   && request.resource.size < 10 * 1024 * 1024; // 限制文件大小 10MB
    }
    
    // 默认规则：拒绝所有其他访问
    match /{allPaths=**} {
      allow read, write: if false;
    }
  }
} 